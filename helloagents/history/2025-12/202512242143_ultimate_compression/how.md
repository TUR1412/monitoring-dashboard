# 技术设计: 终极压缩与自洽迭代

## 技术方案

### 核心技术
- 原生 HTML/CSS/JS（默认运行路径）
- Vite（可选生产构建压缩路径）

### 实现要点
- **JS 去重抽象**
  - 统一 DOM 查询、事件节流、localStorage 安全读写、mailto 构造与触发
  - 保持渐进增强：DOM 不存在时安全短路
- **CSS 去重合并**
  - 识别重复 selector（例如 `.navbar`/`.hero`/`.btn` 等）
  - 以“最终生效样式”为准合并到单处定义，删除早期覆盖段落
  - 保留 reduced-motion、dark theme 与玻璃拟态效果
- **构建压缩（Vite）**
  - `build.minify = "terser"`，开启 aggressive compress/mangle
  - `build.cssCodeSplit` 视需要关闭，减少请求数
  - `build.rollupOptions.treeshake` 开启并收敛副作用边界
  - 不强制改变默认运行方式：构建仅输出 `dist/`，便于部署

## 架构决策 ADR

### ADR-003: 引入“可选构建压缩层”
**上下文:** 运行时零依赖已满足，但面向“极限体积/性能预算”的部署需要更强压缩与 tree-shaking。  
**决策:** 引入 Vite 作为可选构建工具链，仅影响生产构建，不改变默认“直接打开”能力。  
**理由:** 能在不牺牲开箱即用的情况下提供更小产物与更稳定的部署体验。  
**替代方案:** 继续保持无构建 → 拒绝原因: 产物压缩与 tree-shaking 能力不足。  
**影响:** 增加 devDependencies 与构建配置，需要 README 指引。

## 安全与性能
- **安全:** 保持 CSP 基线，不引入第三方脚本；构建工具链仅为开发侧依赖
- **性能:** JS 逻辑去重 + CSS 去重减少覆盖链与文件体积；构建路径进一步压缩部署产物

## 测试与部署
- **测试:**
  - 静态扫描：无第三方静态资源依赖；CSS 变量无未定义引用
  - 语法检查：JS/JSON 通过校验
  - 手动烟测：导航/主题/筛选/表单/scroll-spy
- **部署:**
  - 默认：直接部署仓库根目录
  - 生产构建：部署 `dist/`（更小产物）

