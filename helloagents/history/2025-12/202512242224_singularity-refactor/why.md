# 变更提案: Singularity Refactor（监控看板演示工程）

## 需求背景

当前工程作为监控看板演示项目，功能覆盖面广（仪表盘/遥测/告警/安全/日志/用户管理），但随着组件与页面增多，容易出现以下典型问题：

1. **状态管理耦合**：单一巨型 Store 导致跨域依赖、难以测试与维护。
2. **工具逻辑重复**：HTTP、存储、下载、时间格式化等能力分散在各处，出现重复实现。
3. **依赖冗余**：部分能力可由浏览器原生 API 覆盖，但仍引入第三方库，带来包体与维护成本。
4. **UI 体系不一致**：图标、交互反馈与视觉细节不统一，影响商业化质感。
5. **文档失真**：README 与真实代码存在偏差，无法作为可靠使用说明与二次开发参考。

本次变更的目标是对工程进行一次“架构自洽 + 体验一致 + 依赖减重”的系统性升级。

## 变更内容

1. **领域化 Pinia Store**
   - 按业务域拆分：`auth/theme/tabs/users/alerts/telemetry/ui`。
2. **基础设施层（Infra Utils）**
   - 提供无依赖的 `http/storage/datetime/download` 工具集，统一错误结构与行为。
3. **图标体系升级**
   - 自研 `AppIcon` 内联 SVG，替代 FontAwesome，降低依赖与渲染成本。
4. **路由与加载策略优化**
   - 路由懒加载 + 鉴权门禁，减少首屏成本并提升可维护性。
5. **文档与 SSOT（知识库）补齐**
   - 重写 README 并补齐 `helloagents/` 知识库，确保文档与代码一致。

## 影响范围

- **模块：**
  - App Shell / Auth / Alerts / Users / Telemetry / Security / Charts / Utils
- **文件：**
  - `src/stores/*`（新增/拆分/重构）
  - `src/utils/*`（新增）
  - `src/router/index.js`、`src/main.js`
  - `src/components/*`（图标迁移与 UI 自洽）
  - `package.json`、`package-lock.json`、`vite.config.js`
  - `README.md`
  - `helloagents/wiki/*`、`helloagents/project.md`、`helloagents/CHANGELOG.md`

## 核心场景

### 需求: 登录与路由门禁
**模块:** Auth / App Shell  
用户未登录时访问受保护页面，应被重定向至登录页；登录后恢复正常导航。

#### 场景: 未登录访问任意受保护页面
- 预期结果：跳转到登录页，且不会产生异常白屏

### 需求: 告警闭环与导出
**模块:** Alerts  
用户可查看历史告警、筛选并导出数据，导出文件可正确下载。

#### 场景: 导出筛选后的告警记录
- 预期结果：下载成功，字段结构清晰且编码正确

### 需求: UI 一致性与依赖减重
**模块:** UI / Utils  
项目不应依赖大体积 UI/图标库来实现基础能力；图标、按钮、提示统一。

#### 场景: 页面交互反馈
- 预期结果：成功/失败 toast 一致，确认弹窗一致

## 风险评估

- **风险:** 大规模重构导致导入路径/引用点遗漏  
  **缓解:** 全局搜索（依赖关键词/图标 class）+ `npm run build` 构建验证。
- **风险:** 依赖移除后行为不一致（例如下载/时间格式）  
  **缓解:** 统一 utils 接口，并在关键页面调用点验证。

